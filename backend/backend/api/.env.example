# ============================================================================
# ENVIRONMENT VARIABLES FOR CRYPTOWALLET BACKEND API
# ============================================================================
# IMPORTANT: This file documents all required environment variables.
# DO NOT add actual secrets here. Copy to .env and fill with real values.
# NEVER commit .env to version control.
# ============================================================================

# ============================================================================
# Application Configuration
# ============================================================================
# Node environment: development | staging | production
NODE_ENV=development

# Server port (default: 3000)
PORT=3000

# ============================================================================
# CORS Configuration
# ============================================================================
# Allowed origins for CORS (comma-separated list)
# REQUIRED IN PRODUCTION - app will warn if not set
# Example: https://app.example.com,https://admin.example.com
# Development: Defaults to localhost:3000,localhost:3001,localhost:8080
CORS_ALLOWED_ORIGINS=https://yourdomain.com,https://app.yourdomain.com

# ============================================================================
# Database URLs (Neon PostgreSQL)
# ============================================================================
# REQUIRED: One of these must be set based on NODE_ENV
# Development database URL
DATABASE_URL_DEV=postgresql://user:password@host.neon.tech/dbname?sslmode=require

# Staging database URL
DATABASE_URL_STAGING=postgresql://user:password@host.neon.tech/dbname?sslmode=require

# Production database URL (KEEP SECURE - rotate regularly)
DATABASE_URL_PROD=postgresql://user:password@host.neon.tech/dbname?sslmode=require

# ============================================================================
# JWT Authentication
# ============================================================================
# REQUIRED: Secret key for signing JWT tokens
# Generate with: openssl rand -base64 32
# Rotate regularly for security
JWT_SECRET=your_generated_secret_key_here_min_32_chars

# ============================================================================
# Payment Provider Secrets (OnRamp Integration)
# ============================================================================
# MoonPay API credentials (for payment processing)
MOONPAY_API_KEY=your_moonpay_api_key_here
MOONPAY_WEBHOOK_SECRET=your_moonpay_webhook_secret_here

# Stripe API credentials (for payment processing)
STRIPE_API_KEY=your_stripe_secret_key_here
STRIPE_WEBHOOK_SECRET=your_stripe_webhook_secret_here

# Transak API credentials (for payment processing)
TRANSAK_API_KEY=your_transak_api_key_here
TRANSAK_WEBHOOK_SECRET=your_transak_webhook_secret_here

# Paystack API credentials (for payment processing)
PAYSTACK_API_KEY=your_paystack_secret_key_here
PAYSTACK_WEBHOOK_SECRET=your_paystack_webhook_secret_here

# ============================================================================
# Reconciliation & Monitoring Configuration
# ============================================================================
# How often to check wallet balances vs ledger (milliseconds)
# Default: 900000 (15 minutes)
LEDGER_INTEGRITY_INTERVAL_MS=900000

# How often to check provider webhooks vs on-ramp records (milliseconds)
# Default: 3600000 (1 hour)
PROVIDER_RECONCILIATION_INTERVAL_MS=3600000

# How often to retry failed webhooks (milliseconds)
# Default: 300000 (5 minutes)
WEBHOOK_RETRY_INTERVAL_MS=300000

# Maximum number of webhook retry attempts before moving to dead-letter queue
# Default: 3
WEBHOOK_MAX_RETRIES=3

# ============================================================================
# Alert Thresholds Configuration
# ============================================================================
# Balance mismatch threshold (USD) - alert if wallet != ledger by more than this
# Default: 0.01 ($0.01)
ALERT_BALANCE_MISMATCH_THRESHOLD=0.01

# Alert if more than this many webhook failures occur in time window
# Default: 5
ALERT_WEBHOOK_FAILURE_THRESHOLD=5

# Time window for webhook failure alerts (minutes)
# Default: 60 (1 hour)
ALERT_WEBHOOK_FAILURE_WINDOW_MINUTES=60

# Alert if credit transactions exceed this amount per minute (USD)
# Default: 1000 ($1000/min)
ALERT_CREDIT_SPIKE_THRESHOLD=1000

# ============================================================================
# Database Configuration
# ============================================================================
# Maximum number of database connections (recommend ≤100 for production)
DATABASE_MAX_CONNECTIONS=10

# ============================================================================
# Backup Configuration
# ============================================================================
# REQUIRED IN PRODUCTION: Enable automated backups
BACKUP_ENABLED=true

# Number of days to retain backups (recommend 7-30)
BACKUP_RETENTION_DAYS=7

# Enable backup upload to cloud storage (S3, GCS, etc.)
BACKUP_UPLOAD_ENABLED=false

# AWS S3 configuration (if using S3 for backups)
AWS_S3_BACKUP_BUCKET=your-cryptowallet-backups

# Google Cloud Storage configuration (if using GCS for backups)
GCS_BACKUP_BUCKET=your-cryptowallet-backups

# CRITICAL: Date of last successful backup restore test
# Must be tested every 90 days minimum
# "If backups aren't tested, they don't exist"
LAST_BACKUP_RESTORE_TEST_DATE=2026-01-01

# Test database URL (for backup restore testing - staging only)
TEST_DATABASE_URL=postgresql://user:password@host.neon.tech/test_db?sslmode=require

# ============================================================================
# Secrets & Access Control
# ============================================================================
# CRITICAL: Track when secrets were last rotated
# Rotate every 90 days for production security
# Format: YYYY-MM-DD

JWT_SECRET_ROTATION_DATE=2026-01-01
DB_CREDENTIALS_ROTATION_DATE=2026-01-01
MOONPAY_SECRET_ROTATION_DATE=2026-01-01
STRIPE_SECRET_ROTATION_DATE=2026-01-01
TRANSAK_SECRET_ROTATION_DATE=2026-01-01
PAYSTACK_SECRET_ROTATION_DATE=2026-01-01

# IP Allowlist for Webhooks (comma-separated)
# Production: Restrict to known provider IPs for defense-in-depth
# Supports exact IPs, CIDR notation, and wildcards
# Example: 192.168.1.100,10.0.0.0/8,172.16.*
# Leave empty to rely on signature verification only (less secure)
WEBHOOK_ALLOWED_IPS=

# MoonPay IPs (example - verify actual IPs from MoonPay documentation)
# WEBHOOK_ALLOWED_IPS=52.18.0.0/16,34.248.0.0/16

# ============================================================================
# SECURITY NOTES
# ============================================================================
# ✅ DO: Load secrets from environment variables only
# ✅ DO: Use strong, randomly generated secrets (min 32 chars for JWT)
# ✅ DO: Rotate secrets regularly
# ✅ DO: Use different secrets for each environment (dev/staging/prod)
# ✅ DO: Keep .env file excluded from version control (see .gitignore)
#
# ❌ DON'T: Hardcode secrets in source code
# ❌ DON'T: Log secrets to console or error messages
# ❌ DON'T: Commit .env to Git
# ❌ DON'T: Share .env files in chat, email, or documentation
# ============================================================================
